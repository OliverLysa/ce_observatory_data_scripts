(function(){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var worker={},isObservable=e=>e?typeof Symbol.observable=="symbol"&&typeof e[Symbol.observable]=="function"?e===e[Symbol.observable]():typeof e["@@observable"]=="function"?e===e["@@observable"]():!1:!1,common={},serializers={};Object.defineProperty(serializers,"__esModule",{value:!0}),serializers.DefaultSerializer=serializers.extendSerializer=void 0;function extendSerializer(e,n){const r=e.deserialize.bind(e),t=e.serialize.bind(e);return{deserialize(s){return n.deserialize(s,r)},serialize(s){return n.serialize(s,t)}}}serializers.extendSerializer=extendSerializer;const DefaultErrorSerializer={deserialize(e){return Object.assign(Error(e.message),{name:e.name,stack:e.stack})},serialize(e){return{__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack}}},isSerializedError=e=>e&&typeof e=="object"&&"__error_marker"in e&&e.__error_marker==="$$error";serializers.DefaultSerializer={deserialize(e){return isSerializedError(e)?DefaultErrorSerializer.deserialize(e):e},serialize(e){return e instanceof Error?DefaultErrorSerializer.serialize(e):e}},Object.defineProperty(common,"__esModule",{value:!0}),common.serialize=common.deserialize=common.registerSerializer=void 0;const serializers_1=serializers;let registeredSerializer=serializers_1.DefaultSerializer;function registerSerializer(e){registeredSerializer=serializers_1.extendSerializer(registeredSerializer,e)}common.registerSerializer=registerSerializer;function deserialize(e){return registeredSerializer.deserialize(e)}common.deserialize=deserialize;function serialize(e){return registeredSerializer.serialize(e)}common.serialize=serialize;var transferable={},symbols={};Object.defineProperty(symbols,"__esModule",{value:!0}),symbols.$worker=symbols.$transferable=symbols.$terminate=symbols.$events=symbols.$errors=void 0,symbols.$errors=Symbol("thread.errors"),symbols.$events=Symbol("thread.events"),symbols.$terminate=Symbol("thread.terminate"),symbols.$transferable=Symbol("thread.transferable"),symbols.$worker=Symbol("thread.worker"),Object.defineProperty(transferable,"__esModule",{value:!0}),transferable.Transfer=transferable.isTransferDescriptor=void 0;const symbols_1=symbols;function isTransferable(e){return!(!e||typeof e!="object")}function isTransferDescriptor(e){return e&&typeof e=="object"&&e[symbols_1.$transferable]}transferable.isTransferDescriptor=isTransferDescriptor;function Transfer$1(e,n){if(!n){if(!isTransferable(e))throw Error();n=[e]}return{[symbols_1.$transferable]:!0,send:e,transferables:n}}transferable.Transfer=Transfer$1;var messages={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,function(n){n.cancel="cancel",n.run="run"}(e.MasterMessageType||(e.MasterMessageType={})),function(n){n.error="error",n.init="init",n.result="result",n.running="running",n.uncaughtError="uncaughtError"}(e.WorkerMessageType||(e.WorkerMessageType={}))})(messages);var implementation$1={},implementation_browser={};Object.defineProperty(implementation_browser,"__esModule",{value:!0});const isWorkerRuntime$2=function(){const n=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!n)},postMessageToMaster$2=function(n,r){self.postMessage(n,r)},subscribeToMasterMessages$2=function(n){const r=s=>{n(s.data)},t=()=>{self.removeEventListener("message",r)};return self.addEventListener("message",r),t};implementation_browser.default={isWorkerRuntime:isWorkerRuntime$2,postMessageToMaster:postMessageToMaster$2,subscribeToMasterMessages:subscribeToMasterMessages$2};var implementation_tinyWorker={};Object.defineProperty(implementation_tinyWorker,"__esModule",{value:!0}),typeof self>"u"&&(commonjsGlobal.self=commonjsGlobal);const isWorkerRuntime$1=function(){return!!(typeof self<"u"&&self.postMessage)},postMessageToMaster$1=function(n){self.postMessage(n)};let muxingHandlerSetUp=!1;const messageHandlers=new Set,subscribeToMasterMessages$1=function(n){return muxingHandlerSetUp||(self.addEventListener("message",t=>{messageHandlers.forEach(s=>s(t.data))}),muxingHandlerSetUp=!0),messageHandlers.add(n),()=>messageHandlers.delete(n)};implementation_tinyWorker.default={isWorkerRuntime:isWorkerRuntime$1,postMessageToMaster:postMessageToMaster$1,subscribeToMasterMessages:subscribeToMasterMessages$1};var implementation_worker_threads={},worker_threads={};Object.defineProperty(worker_threads,"__esModule",{value:!0});let implementation;function selectImplementation(){return typeof __non_webpack_require__=="function"?__non_webpack_require__("worker_threads"):eval("require")("worker_threads")}function getImplementation(){return implementation||(implementation=selectImplementation()),implementation}worker_threads.default=getImplementation;var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(implementation_worker_threads,"__esModule",{value:!0});const worker_threads_1=__importDefault$1(worker_threads);function assertMessagePort(e){if(!e)throw Error("Invariant violation: MessagePort to parent is not available.");return e}const isWorkerRuntime=function e(){return!worker_threads_1.default().isMainThread},postMessageToMaster=function e(n,r){assertMessagePort(worker_threads_1.default().parentPort).postMessage(n,r)},subscribeToMasterMessages=function e(n){const r=worker_threads_1.default().parentPort;if(!r)throw Error("Invariant violation: MessagePort to parent is not available.");const t=a=>{n(a)},s=()=>{assertMessagePort(r).off("message",t)};return assertMessagePort(r).on("message",t),s};function testImplementation(){worker_threads_1.default()}implementation_worker_threads.default={isWorkerRuntime,postMessageToMaster,subscribeToMasterMessages,testImplementation};var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(implementation$1,"__esModule",{value:!0});const implementation_browser_1=__importDefault(implementation_browser),implementation_tiny_worker_1=__importDefault(implementation_tinyWorker),implementation_worker_threads_1=__importDefault(implementation_worker_threads),runningInNode=typeof process<"u"&&process.arch!=="browser"&&"pid"in process;function selectNodeImplementation(){try{return implementation_worker_threads_1.default.testImplementation(),implementation_worker_threads_1.default}catch{return implementation_tiny_worker_1.default}}implementation$1.default=runningInNode?selectNodeImplementation():implementation_browser_1.default,function(e){var n=commonjsGlobal&&commonjsGlobal.__awaiter||function(o,d,_,M){function O(k){return k instanceof _?k:new _(function(B){B(k)})}return new(_||(_=Promise))(function(k,B){function W(z){try{P(M.next(z))}catch(x){B(x)}}function R(z){try{P(M.throw(z))}catch(x){B(x)}}function P(z){z.done?k(z.value):O(z.value).then(W,R)}P((M=M.apply(o,d||[])).next())})},r=commonjsGlobal&&commonjsGlobal.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const t=r(isObservable),s=common,a=transferable,i=messages,u=r(implementation$1);var c=common;Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return c.registerSerializer}});var l=transferable;Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return l.Transfer}}),e.isWorkerRuntime=u.default.isWorkerRuntime;let h=!1;const p=new Map,I=o=>o&&o.type===i.MasterMessageType.cancel,m=o=>o&&o.type===i.MasterMessageType.run,v=o=>t.default(o)||T(o);function T(o){return o&&typeof o=="object"&&typeof o.subscribe=="function"}function E(o){return a.isTransferDescriptor(o)?{payload:o.send,transferables:o.transferables}:{payload:o,transferables:void 0}}function L(){const o={type:i.WorkerMessageType.init,exposed:{type:"function"}};u.default.postMessageToMaster(o)}function w(o){const d={type:i.WorkerMessageType.init,exposed:{type:"module",methods:o}};u.default.postMessageToMaster(d)}function f(o,d){const{payload:_,transferables:M}=E(d),O={type:i.WorkerMessageType.error,uid:o,error:s.serialize(_)};u.default.postMessageToMaster(O,M)}function g(o,d,_){const{payload:M,transferables:O}=E(_),k={type:i.WorkerMessageType.result,uid:o,complete:d?!0:void 0,payload:M};u.default.postMessageToMaster(k,O)}function S(o,d){const _={type:i.WorkerMessageType.running,uid:o,resultType:d};u.default.postMessageToMaster(_)}function b(o){try{const d={type:i.WorkerMessageType.uncaughtError,error:s.serialize(o)};u.default.postMessageToMaster(d)}catch(d){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,d,`
Original error:`,o)}}function y(o,d,_){return n(this,void 0,void 0,function*(){let M;try{M=d(..._)}catch(k){return f(o,k)}const O=v(M)?"observable":"promise";if(S(o,O),v(M)){const k=M.subscribe(B=>g(o,!1,s.serialize(B)),B=>{f(o,s.serialize(B)),p.delete(o)},()=>{g(o,!0),p.delete(o)});p.set(o,k)}else try{const k=yield M;g(o,!0,s.serialize(k))}catch(k){f(o,s.serialize(k))}})}function A(o){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(h)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(h=!0,typeof o=="function")u.default.subscribeToMasterMessages(d=>{m(d)&&!d.method&&y(d.uid,o,d.args.map(s.deserialize))}),L();else if(typeof o=="object"&&o){u.default.subscribeToMasterMessages(_=>{m(_)&&_.method&&y(_.uid,o[_.method],_.args.map(s.deserialize))});const d=Object.keys(o).filter(_=>typeof o[_]=="function");w(d)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${o}`);u.default.subscribeToMasterMessages(d=>{if(I(d)){const _=d.uid,M=p.get(_);M&&(M.unsubscribe(),p.delete(_))}})}e.expose=A,typeof self<"u"&&typeof self.addEventListener=="function"&&u.default.isWorkerRuntime()&&(self.addEventListener("error",o=>{setTimeout(()=>b(o.error||o),250)}),self.addEventListener("unhandledrejection",o=>{const d=o.reason;d&&typeof d.message=="string"&&setTimeout(()=>b(d),250)})),typeof process<"u"&&typeof process.on=="function"&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",o=>{setTimeout(()=>b(o),250)}),process.on("unhandledRejection",o=>{o&&typeof o.message=="string"&&setTimeout(()=>b(o),250)}))}(worker);const WorkerContext=getDefaultExportFromCjs(worker),expose=WorkerContext.expose;WorkerContext.registerSerializer;const Transfer=WorkerContext.Transfer;function getEncodedVarIndicesLength(e){var n;let r=1;for(const t of e){r+=2;const s=((n=t.subscriptIndices)==null?void 0:n.length)||0;r+=s}return r}function encodeVarIndices(e,n){let r=0;n[r++]=e.length;for(const t of e){n[r++]=t.varIndex;const s=t.subscriptIndices,a=(s==null?void 0:s.length)||0;n[r++]=a;for(let i=0;i<a;i++)n[r++]=s[i]}}function getEncodedLookupBufferLengths(e){var n;let r=1,t=0;for(const s of e){const a=s.varRef.varSpec;if(a===void 0)throw new Error("Cannot compute lookup buffer lengths until all lookup var specs are defined");r+=2;const i=((n=a.subscriptIndices)==null?void 0:n.length)||0;r+=i,r+=2,t+=s.points.length}return{lookupIndicesLength:r,lookupsLength:t}}function encodeLookups(e,n,r){let t=0;n[t++]=e.length;let s=0;for(const a of e){const i=a.varRef.varSpec;n[t++]=i.varIndex;const u=i.subscriptIndices,c=(u==null?void 0:u.length)||0;n[t++]=c;for(let l=0;l<c;l++)n[t++]=u[l];n[t++]=s,n[t++]=a.points.length,r==null||r.set(a.points,s),s+=a.points.length}}function decodeLookups(e,n){const r=[];let t=0;const s=e[t++];for(let a=0;a<s;a++){const i=e[t++],u=e[t++],c=u>0?Array(u):void 0;for(let m=0;m<u;m++)c[m]=e[t++];const l=e[t++],h=e[t++],p={varIndex:i,subscriptIndices:c};let I;n?I=n.slice(l,l+h):I=new Float64Array(0),r.push({varRef:{varSpec:p},points:I})}return r}function resolveVarRef(e,n,r){if(!n.varSpec){if(e===void 0)throw new Error(`Unable to resolve ${r} variable references by name or identifier when model listing is unavailable`);if(n.varId){const t=e==null?void 0:e.getSpecForVarId(n.varId);if(t)n.varSpec=t;else throw new Error(`Failed to resolve ${r} variable reference for varId=${n.varId}`)}else{const t=e==null?void 0:e.getSpecForVarName(n.varName);if(t)n.varSpec=t;else throw new Error(`Failed to resolve ${r} variable reference for varName='${n.varId}'`)}}}var headerLengthInElements=16,extrasLengthInElements=1,Int32Section=class{constructor(){this.offsetInBytes=0,this.lengthInElements=0}update(e,n,r){this.view=r>0?new Int32Array(e,n,r):void 0,this.offsetInBytes=n,this.lengthInElements=r}},Float64Section=class{constructor(){this.offsetInBytes=0,this.lengthInElements=0}update(e,n,r){this.view=r>0?new Float64Array(e,n,r):void 0,this.offsetInBytes=n,this.lengthInElements=r}},BufferedRunModelParams=class{constructor(e){this.listing=e,this.header=new Int32Section,this.extras=new Float64Section,this.inputs=new Float64Section,this.outputs=new Float64Section,this.outputIndices=new Int32Section,this.lookups=new Float64Section,this.lookupIndices=new Int32Section}getEncodedBuffer(){return this.encoded}getInputs(){return this.inputs.view}copyInputs(e,n){this.inputs.lengthInElements!==0&&((e===void 0||e.length<this.inputs.lengthInElements)&&(e=n(this.inputs.lengthInElements)),e.set(this.inputs.view))}getOutputIndicesLength(){return this.outputIndices.lengthInElements}getOutputIndices(){return this.outputIndices.view}copyOutputIndices(e,n){this.outputIndices.lengthInElements!==0&&((e===void 0||e.length<this.outputIndices.lengthInElements)&&(e=n(this.outputIndices.lengthInElements)),e.set(this.outputIndices.view))}getOutputsLength(){return this.outputs.lengthInElements}getOutputs(){return this.outputs.view}getOutputsObject(){}storeOutputs(e){this.outputs.view!==void 0&&(e.length>this.outputs.view.length?this.outputs.view.set(e.subarray(0,this.outputs.view.length)):this.outputs.view.set(e))}getLookups(){if(this.lookupIndices.lengthInElements!==0)return decodeLookups(this.lookupIndices.view,this.lookups.view)}getElapsedTime(){return this.extras.view[0]}storeElapsedTime(e){this.extras.view[0]=e}finalizeOutputs(e){this.outputs.view&&e.updateFromBuffer(this.outputs.view,e.seriesLength),e.runTimeInMillis=this.getElapsedTime()}updateFromParams(e,n,r){const t=e.length,s=n.varIds.length*n.seriesLength;let a;const i=n.varSpecs;i!==void 0&&i.length>0?a=getEncodedVarIndicesLength(i):a=0;let u,c;if((r==null?void 0:r.lookups)!==void 0&&r.lookups.length>0){for(const y of r.lookups)resolveVarRef(this.listing,y.varRef,"lookup");const b=getEncodedLookupBufferLengths(r.lookups);u=b.lookupsLength,c=b.lookupIndicesLength}else u=0,c=0;let l=0;function h(b,y){const A=l,o=b==="float64"?Float64Array.BYTES_PER_ELEMENT:Int32Array.BYTES_PER_ELEMENT,d=Math.round(y*o),_=Math.ceil(d/8)*8;return l+=_,A}const p=h("int32",headerLengthInElements),I=h("float64",extrasLengthInElements),m=h("float64",t),v=h("float64",s),T=h("int32",a),E=h("float64",u),L=h("int32",c),w=l;if(this.encoded===void 0||this.encoded.byteLength<w){const b=Math.ceil(w*1.2);this.encoded=new ArrayBuffer(b),this.header.update(this.encoded,p,headerLengthInElements)}const f=this.header.view;let g=0;f[g++]=I,f[g++]=extrasLengthInElements,f[g++]=m,f[g++]=t,f[g++]=v,f[g++]=s,f[g++]=T,f[g++]=a,f[g++]=E,f[g++]=u,f[g++]=L,f[g++]=c,this.inputs.update(this.encoded,m,t),this.extras.update(this.encoded,I,extrasLengthInElements),this.outputs.update(this.encoded,v,s),this.outputIndices.update(this.encoded,T,a),this.lookups.update(this.encoded,E,u),this.lookupIndices.update(this.encoded,L,c);const S=this.inputs.view;for(let b=0;b<e.length;b++){const y=e[b];typeof y=="number"?S[b]=y:S[b]=y.get()}this.outputIndices.view&&encodeVarIndices(i,this.outputIndices.view),c>0&&encodeLookups(r.lookups,this.lookupIndices.view,this.lookups.view)}updateFromEncodedBuffer(e){const n=headerLengthInElements*Int32Array.BYTES_PER_ELEMENT;if(e.byteLength<n)throw new Error("Buffer must be long enough to contain header section");this.encoded=e,this.header.update(this.encoded,0,headerLengthInElements);const t=this.header.view;let s=0;const a=t[s++],i=t[s++],u=t[s++],c=t[s++],l=t[s++],h=t[s++],p=t[s++],I=t[s++],m=t[s++],v=t[s++],T=t[s++],E=t[s++],L=i*Float64Array.BYTES_PER_ELEMENT,w=c*Float64Array.BYTES_PER_ELEMENT,f=h*Float64Array.BYTES_PER_ELEMENT,g=I*Int32Array.BYTES_PER_ELEMENT,S=v*Float64Array.BYTES_PER_ELEMENT,b=E*Int32Array.BYTES_PER_ELEMENT,y=n+L+w+f+g+S+b;if(e.byteLength<y)throw new Error("Buffer must be long enough to contain sections declared in header");this.extras.update(this.encoded,a,i),this.inputs.update(this.encoded,u,c),this.outputs.update(this.encoded,l,h),this.outputIndices.update(this.encoded,p,I),this.lookups.update(this.encoded,m,v),this.lookupIndices.update(this.encoded,T,E)}},_NA_=-Number.MAX_VALUE,JsModelLookup=class{constructor(e,n){if(this.n=e,this.data=n,n.length<e*2)throw new Error(`Lookup data array length must be >= 2*size (length=${n.length} size=${e}`);this.lastInput=Number.MAX_VALUE,this.lastHitIndex=0}getValueForX(e,n){return this.getValue(e,!1,n)}getValueForY(e){if(this.invertedData===void 0){const n=this.n*2,r=this.data,t=Array(n);for(let s=0;s<n;s+=2)t[s]=r[s+1],t[s+1]=r[s];this.invertedData=t}return this.getValue(e,!0,"interpolate")}getValue(e,n,r){if(this.n===0)return _NA_;const t=n?this.invertedData:this.data,s=this.n*2,a=!n;let i;a&&e>=this.lastInput?i=this.lastHitIndex:i=0;for(let u=i;u<s;u+=2){const c=t[u];if(c>=e){if(a&&(this.lastInput=e,this.lastHitIndex=u),u===0||c===e)return t[u+1];switch(r){default:case"interpolate":{const l=t[u-2],h=t[u-1],p=t[u+1],I=c-l,m=p-h;return h+m/I*(e-l)}case"forward":return t[u+1];case"backward":return t[u-1]}}}return a&&(this.lastInput=e,this.lastHitIndex=s),t[s-1]}getValueForGameTime(e,n){if(this.n<=0)return n;const r=this.data[0];return e<r?n:this.getValue(e,!1,"backward")}getValueBetweenTimes(e,n){if(this.n===0)return _NA_;const r=this.n*2;switch(n){case"forward":{e=Math.floor(e);for(let t=0;t<r;t+=2)if(this.data[t]>=e)return this.data[t+1];return this.data[r-1]}case"backward":{e=Math.floor(e);for(let t=2;t<r;t+=2)if(this.data[t]>=e)return this.data[t-1];return r>=4?this.data[r-3]:this.data[1]}case"interpolate":default:{if(e-Math.floor(e)>0){let t=`GET DATA BETWEEN TIMES was called with an input value (${e}) that has a fractional part. `;throw t+="When mode is 0 (interpolate) and the input value is not a whole number, Vensim produces unexpected ",t+="results that may differ from those produced by SDEverywhere.",new Error(t)}for(let t=2;t<r;t+=2){const s=this.data[t];if(s>=e){const a=this.data[t-2],i=this.data[t-1],u=this.data[t+1],c=s-a,l=u-i;return i+l/c*(e-a)}}return this.data[r-1]}}}},EPSILON=1e-6;function getJsModelFunctions(){let e;const n=new Map,r=new Map;return{setContext(t){e=t},ABS(t){return Math.abs(t)},ARCCOS(t){return Math.acos(t)},ARCSIN(t){return Math.asin(t)},ARCTAN(t){return Math.atan(t)},COS(t){return Math.cos(t)},EXP(t){return Math.exp(t)},GAME(t,s){return t?t.getValueForGameTime(e.currentTime,s):s},INTEG(t,s){return t+s*e.timeStep},INTEGER(t){return Math.trunc(t)},LN(t){return Math.log(t)},MAX(t,s){return Math.max(t,s)},MIN(t,s){return Math.min(t,s)},MODULO(t,s){return t%s},POW(t,s){return Math.pow(t,s)},POWER(t,s){return Math.pow(t,s)},PULSE(t,s){return pulse(e,t,s)},PULSE_TRAIN(t,s,a,i){const u=Math.floor((i-t)/a);for(let c=0;c<=u;c++)if(e.currentTime<=i&&pulse(e,t+c*a,s))return 1;return 0},QUANTUM(t,s){return s<=0?t:s*Math.trunc(t/s)},RAMP(t,s,a){return e.currentTime>s?e.currentTime<a||s>a?t*(e.currentTime-s):t*(a-s):0},SIN(t){return Math.sin(t)},SQRT(t){return Math.sqrt(t)},STEP(t,s){return e.currentTime+e.timeStep/2>s?t:0},TAN(t){return Math.tan(t)},VECTOR_SORT_ORDER(t,s,a){if(s>t.length)throw new Error(`VECTOR SORT ORDER input vector length (${t.length}) must be >= size (${s})`);let i=r.get(s);if(i===void 0){i=Array(s);for(let l=0;l<s;l++)i[l]={x:0,ind:0};r.set(s,i)}let u=n.get(s);u===void 0&&(u=Array(s),n.set(s,u));for(let l=0;l<s;l++)i[l].x=t[l],i[l].ind=l;const c=a>0?1:-1;i.sort((l,h)=>{let p;return l.x<h.x?p=-1:l.x>h.x?p=1:p=0,p*c});for(let l=0;l<s;l++)u[l]=i[l].ind;return u},XIDZ(t,s,a){return Math.abs(s)<EPSILON?a:t/s},ZIDZ(t,s){return Math.abs(s)<EPSILON?0:t/s},createLookup(t,s){return new JsModelLookup(t,s)},LOOKUP(t,s){return t?t.getValueForX(s,"interpolate"):_NA_},LOOKUP_FORWARD(t,s){return t?t.getValueForX(s,"forward"):_NA_},LOOKUP_BACKWARD(t,s){return t?t.getValueForX(s,"backward"):_NA_},LOOKUP_INVERT(t,s){return t?t.getValueForY(s):_NA_},WITH_LOOKUP(t,s){return s?s.getValueForX(t,"interpolate"):_NA_},GET_DATA_BETWEEN_TIMES(t,s,a){let i;return a>=1?i="forward":a<=-1?i="backward":i="interpolate",t?t.getValueBetweenTimes(s,i):_NA_}}}function pulse(e,n,r){const t=e.currentTime+e.timeStep/2;return r===0&&(r=e.timeStep),t>n&&t<n+r?1:0}var isWeb;function perfNow(){return isWeb===void 0&&(isWeb=typeof self<"u"&&(self==null?void 0:self.performance)!==void 0),isWeb?self.performance.now():process==null?void 0:process.hrtime()}function perfElapsed(e){if(isWeb)return self.performance.now()-e;{const n=process.hrtime(e);return(n[0]*1e9+n[1])/1e6}}var BaseRunnableModel=class{constructor(e){this.startTime=e.startTime,this.endTime=e.endTime,this.saveFreq=e.saveFreq,this.numSavePoints=e.numSavePoints,this.outputVarIds=e.outputVarIds,this.modelListing=e.modelListing,this.onRunModel=e.onRunModel}runModel(e){var n;let r=e.getInputs();r===void 0&&(e.copyInputs(this.inputs,c=>(this.inputs=new Float64Array(c),this.inputs)),r=this.inputs);let t=e.getOutputIndices();t===void 0&&e.getOutputIndicesLength()>0&&(e.copyOutputIndices(this.outputIndices,c=>(this.outputIndices=new Int32Array(c),this.outputIndices)),t=this.outputIndices);const s=e.getOutputsLength();(this.outputs===void 0||this.outputs.length<s)&&(this.outputs=new Float64Array(s));const a=this.outputs,i=perfNow();(n=this.onRunModel)==null||n.call(this,r,a,{outputIndices:t,lookups:e.getLookups()});const u=perfElapsed(i);e.storeOutputs(a),e.storeElapsedTime(u)}terminate(){}};function initJsModel(e){let n=e.getModelFunctions();n===void 0&&(n=getJsModelFunctions(),e.setModelFunctions(n));const r=e.getInitialTime(),t=e.getFinalTime(),s=e.getTimeStep(),a=e.getSaveFreq(),i=Math.round((t-r)/a)+1;return new BaseRunnableModel({startTime:r,endTime:t,saveFreq:a,numSavePoints:i,outputVarIds:e.outputVarIds,modelListing:e.modelListing,onRunModel:(u,c,l)=>{runJsModel(e,r,t,s,a,i,u,c,l==null?void 0:l.outputIndices,l==null?void 0:l.lookups)}})}function runJsModel(e,n,r,t,s,a,i,u,c,l,h){let p=n;e.setTime(p);const I={timeStep:t,currentTime:p};if(e.getModelFunctions().setContext(I),e.initConstants(),l!==void 0)for(const w of l)e.setLookup(w.varRef.varSpec,w.points);(i==null?void 0:i.length)>0&&e.setInputs(w=>i[w]),e.initLevels();const m=Math.round((r-n)/t),v=r;let T=0,E=0,L=0;for(;T<=m;){if(e.evalAux(),p%s<1e-6){L=0;const w=f=>{const g=L*a+E;u[g]=p<=v?f:void 0,L++};if(c!==void 0){let f=0;const g=c[f++];for(let S=0;S<g;S++){const b=c[f++],y=c[f++];let A;y>0&&(A=c.subarray(f,f+y),f+=y);const o={varIndex:b,subscriptIndices:A};e.storeOutput(o,w)}}else e.storeOutputs(w);E++}if(T===m)break;e.evalLevels(),p+=t,e.setTime(p),I.currentTime=p,T++}}var WasmBuffer=class{constructor(e,n,r,t){this.wasmModule=e,this.numElements=n,this.byteOffset=r,this.heapArray=t}getArrayView(){return this.heapArray}getAddress(){return this.byteOffset}dispose(){var e,n;this.heapArray&&((n=(e=this.wasmModule)._free)==null||n.call(e,this.byteOffset),this.numElements=void 0,this.heapArray=void 0,this.byteOffset=void 0)}};function createInt32WasmBuffer(e,n){const t=n*4,s=e._malloc(t),a=s/4,i=e.HEAP32.subarray(a,a+n);return new WasmBuffer(e,n,s,i)}function createFloat64WasmBuffer(e,n){const t=n*8,s=e._malloc(t),a=s/8,i=e.HEAPF64.subarray(a,a+n);return new WasmBuffer(e,n,s,i)}var WasmModel=class{constructor(e){this.wasmModule=e;function n(r){return e.cwrap(r,"number",[])()}this.startTime=n("getInitialTime"),this.endTime=n("getFinalTime"),this.saveFreq=n("getSaveper"),this.numSavePoints=Math.round((this.endTime-this.startTime)/this.saveFreq)+1,this.outputVarIds=e.outputVarIds,this.modelListing=e.modelListing,this.wasmSetLookup=e.cwrap("setLookup",null,["number","number","number","number"]),this.wasmRunModel=e.cwrap("runModelWithBuffers",null,["number","number","number"])}runModel(e){var n,r,t,s,a,i,u;const c=e.getLookups();if(c!==void 0)for(const m of c){const v=m.varRef.varSpec,T=((n=v.subscriptIndices)==null?void 0:n.length)||0;let E;T>0?((this.lookupSubIndicesBuffer===void 0||this.lookupSubIndicesBuffer.numElements<T)&&((r=this.lookupSubIndicesBuffer)==null||r.dispose(),this.lookupSubIndicesBuffer=createInt32WasmBuffer(this.wasmModule,T)),this.lookupSubIndicesBuffer.getArrayView().set(v.subscriptIndices),E=this.lookupSubIndicesBuffer.getAddress()):E=0;const L=m.points.length;(this.lookupDataBuffer===void 0||this.lookupDataBuffer.numElements<L)&&((t=this.lookupDataBuffer)==null||t.dispose(),this.lookupDataBuffer=createFloat64WasmBuffer(this.wasmModule,L)),this.lookupDataBuffer.getArrayView().set(m.points);const w=this.lookupDataBuffer.getAddress(),f=L/2,g=v.varIndex;this.wasmSetLookup(g,E,w,f)}e.copyInputs((s=this.inputsBuffer)==null?void 0:s.getArrayView(),m=>{var v;return(v=this.inputsBuffer)==null||v.dispose(),this.inputsBuffer=createFloat64WasmBuffer(this.wasmModule,m),this.inputsBuffer.getArrayView()});let l;e.getOutputIndicesLength()>0?(e.copyOutputIndices((a=this.outputIndicesBuffer)==null?void 0:a.getArrayView(),m=>{var v;return(v=this.outputIndicesBuffer)==null||v.dispose(),this.outputIndicesBuffer=createInt32WasmBuffer(this.wasmModule,m),this.outputIndicesBuffer.getArrayView()}),l=this.outputIndicesBuffer):l=void 0;const h=e.getOutputsLength();(this.outputsBuffer===void 0||this.outputsBuffer.numElements<h)&&((i=this.outputsBuffer)==null||i.dispose(),this.outputsBuffer=createFloat64WasmBuffer(this.wasmModule,h));const p=perfNow();this.wasmRunModel(((u=this.inputsBuffer)==null?void 0:u.getAddress())||0,this.outputsBuffer.getAddress(),(l==null?void 0:l.getAddress())||0);const I=perfElapsed(p);e.storeOutputs(this.outputsBuffer.getArrayView()),e.storeElapsedTime(I)}terminate(){var e,n,r;(e=this.inputsBuffer)==null||e.dispose(),this.inputsBuffer=void 0,(n=this.outputsBuffer)==null||n.dispose(),this.outputsBuffer=void 0,(r=this.outputIndicesBuffer)==null||r.dispose(),this.outputIndicesBuffer=void 0}};function initWasmModel(e){return new WasmModel(e)}function createRunnableModel(e){switch(e.kind){case"js":return initJsModel(e);case"wasm":return initWasmModel(e);default:throw new Error("Unable to identify generated model kind")}}var initGeneratedModel,runnableModel,params=new BufferedRunModelParams,modelWorker={async initModel(){if(runnableModel)throw new Error("RunnableModel was already initialized");const e=await initGeneratedModel();return runnableModel=createRunnableModel(e),{outputVarIds:runnableModel.outputVarIds,modelListing:runnableModel.modelListing,startTime:runnableModel.startTime,endTime:runnableModel.endTime,saveFreq:runnableModel.saveFreq,outputRowLength:runnableModel.numSavePoints}},runModel(e){if(!runnableModel)throw new Error("RunnableModel must be initialized before running the model in worker");return params.updateFromEncodedBuffer(e),runnableModel.runModel(params),Transfer(e)}};function exposeModelWorker(e){initGeneratedModel=e,expose(modelWorker)}let __lookup1,_collection,_final_time,_initial_time,_la_collected_household,_la_collected_other,_litering_rate,_littering,_mismanaged,_normal_rate,_placed_on_market,_placed_on_market_data,_pom,_rate_domestic,_rate_dumped,_rate_overseas,_saveper,_sent_overseas,_time_step,_waste_collected,_waste_collected_sent_to_formal_domestic_treatment,_waste_generated,_waste_generation_rate,_wmc_collected;const __lookup1_data_=[2012,2554750,2013,2260620,2014,2221040,2015,2261020,2016,2261020,2017,2261020,2018,2362060,2019,2473110,2020,2491780,2021,2515490,2022,2246010,2023,2433790,2024,2448580,2025,2460630,2026,2469870,2027,2476250,2030,2493120,2035,2514140,2040,2529710,2042,2534900];let _time;function setTime(e){_time=e}let controlParamsInitialized=!1;function initControlParamsIfNeeded(){if(!controlParamsInitialized){if(fns===void 0)throw new Error("Must call setModelFunctions() before running the model");if(initConstants(),_initial_time===void 0)throw new Error("INITIAL TIME must be defined as a constant value");if(_time_step===void 0)throw new Error("TIME STEP must be defined as a constant value");if(_final_time===void 0||_saveper===void 0){if(setTime(_initial_time),fns.setContext({timeStep:_time_step,currentTime:_time}),initLevels(),evalAux(),_final_time===void 0)throw new Error("FINAL TIME must be defined");if(_saveper===void 0)throw new Error("SAVEPER must be defined")}controlParamsInitialized=!0}}function getInitialTime(){return initControlParamsIfNeeded(),_initial_time}function getFinalTime(){return initControlParamsIfNeeded(),_final_time}function getTimeStep(){return initControlParamsIfNeeded(),_time_step}function getSaveFreq(){return initControlParamsIfNeeded(),_saveper}let fns;function getModelFunctions(){return fns}function setModelFunctions(e){fns=e}let lookups_initialized=!1;function initLookups0(){__lookup1=fns.createLookup(20,__lookup1_data_)}function initLookups(){lookups_initialized||(initLookups0(),lookups_initialized=!0)}function initConstants0(){_final_time=2042,_initial_time=2012,_time_step=1,_la_collected_household=.5,_la_collected_other=.2,_litering_rate=.1,_normal_rate=1,_rate_domestic=.4,_rate_dumped=.05,_rate_overseas=.55,_wmc_collected=.2}function initConstants(){initConstants0(),initLookups()}function initLevels0(){_waste_collected=2e6,_waste_generated=2554750,_placed_on_market_data=fns.WITH_LOOKUP(_time,__lookup1),_placed_on_market=_placed_on_market_data}function initLevels(){initLevels0()}function evalAux0(){_collection=(_la_collected_household+_la_collected_other+_wmc_collected)*_waste_generated,_littering=_litering_rate*_waste_generated,_mismanaged=_rate_dumped*_waste_collected,_placed_on_market_data=fns.WITH_LOOKUP(_time,__lookup1),_saveper=_time_step,_sent_overseas=_rate_overseas*_waste_collected,_waste_collected_sent_to_formal_domestic_treatment=_rate_domestic*_waste_collected,_pom=_placed_on_market,_waste_generation_rate=_normal_rate*_pom}function evalAux(){evalAux0()}function evalLevels0(){_placed_on_market=fns.INTEG(_placed_on_market,_placed_on_market_data-_pom),_waste_collected=fns.INTEG(_waste_collected,_collection-_mismanaged-_sent_overseas-_waste_collected_sent_to_formal_domestic_treatment),_waste_generated=fns.INTEG(_waste_generated,_waste_generation_rate-_collection-_littering)}function evalLevels(){evalLevels0()}function setInputs(e){_la_collected_household=e(0)}function setLookup(e,n){throw new Error("The setLookup function was not enabled for the generated model. Set the customLookups property in the spec/config file to allow for overriding lookups at runtime.")}const outputVarIds=["_placed_on_market","_waste_collected","_waste_generated"],outputVarNames=["Placed on market","Waste collected","Waste generated"];function storeOutputs(e){e(_placed_on_market),e(_waste_collected),e(_waste_generated)}function storeOutput(e,n){throw new Error("The storeOutput function was not enabled for the generated model. Set the customOutputs property in the spec/config file to allow for capturing arbitrary variables at runtime.")}const modelListing=void 0;async function loadGeneratedModel(){return{kind:"js",outputVarIds,outputVarNames,modelListing,getInitialTime,getFinalTime,getTimeStep,getSaveFreq,getModelFunctions,setModelFunctions,setTime,setInputs,setLookup,storeOutputs,storeOutput,initConstants,initLevels,evalAux,evalLevels}}exposeModelWorker(loadGeneratedModel)})();
